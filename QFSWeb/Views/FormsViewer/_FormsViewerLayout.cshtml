<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>@ViewBag.Title</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />

    <link rel="Stylesheet" type="text/css" href="~/Content/App.css" />

    <script src="~/Scripts/Libraries/q.js"></script>
    <script src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script src="~/Scripts/MicrosoftAjax.js"></script>
    <script src="~/Scripts/Qd/shpScriptLoader.js"></script>
    <script>
        var additionalQueryString = '';

        function createAdditionalQueryString() {
            if (additionalQueryString) {
                return additionalQueryString;
            }

            var queryString = window.location.search;

            if (queryString) {
                if (queryString[0] === "?") {
                    queryString = queryString.substring(1);
                }

                var keyValuePairArray = queryString.split("&"),
                    keys = ['SPHostUrl', 'SPLanguage', 'SPClientTag', 'SPProductNumber', 'SPAppWebUrl'],
                    addQueryKeys = keys.map(function (key) {
                        return key + '=' + getQueryStringValue(keyValuePairArray, key);
                    });

                additionalQueryString = "?" + addQueryKeys.join('&') + '&AppOnly=true';

                return additionalQueryString;
            }

            return null;
        }

        function getQueryStringValue(keyValuePairArray, keyName) {
            if (keyValuePairArray == null || keyValuePairArray.length === 0 || keyName === '') {
                return null;
            }

            for (var i = 0; i < keyValuePairArray.length; i++) {
                var currentKeyValuePair = keyValuePairArray[i].split("=");

                if (currentKeyValuePair.length > 1 && currentKeyValuePair[0] === keyName) {
                    return currentKeyValuePair[1];
                }
            }
        }

        qd.shpScriptLoader.loadScriptsAsync();

        $(document).ready(function () {
            //debugger;
            setInterval(function () {
                $.ajax({
                    url: '/webproxy/keepalive' + createAdditionalQueryString(),
                    success: function (data) {
                        console.info('Keep Alive: ', data);
                    },
                    error: function (e, x) {
                        console.info('Keep Alive Error:', e);
                    }
                });
            }, 600000);
        });
    </script>
    @RenderSection("Styles", required: false)
</head>

@* The body is initally hidden.
    The onCssLoaded callback allows you to
    display the content after the required
    resources for the chrome control have
    been loaded.  *@
<body style="display: none; overflow: visible">
    @* Chrome control placeholder *@
    <div id="chrome_ctrl_placeholder"></div>

    <div class="user-name" style="">

    </div>
    <div id="mainContent">
        @RenderBody()
        @Html.Partial("_UiLoader")
    </div>
    <footer id="footer">
        <div class="fvversion"></div>
    </footer>
    @Scripts.Render("~/bundles/formsViewerBase.js")
    @RenderSection("Scripts", required: false)
</body>
</html>
